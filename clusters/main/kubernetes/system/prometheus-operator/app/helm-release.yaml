apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: prometheus-operator
    namespace: prometheus-operator
spec:
    interval: 5m
    chart:
        spec:

            chart: kube-prometheus-stack
            version: 69.8.0
            sourceRef:
                kind: HelmRepository
                name: prometheus-community
                namespace: flux-system
            interval: 5m
    install:
        createNamespace: true
        crds: CreateReplace
        remediation:
            retries: 3
    upgrade:
        crds: CreateReplace
        remediation:
            retries: 3
    values:
      crds:
        enabled: true
      prometheusOperator:
        enabled: true
      global:
        rbac:
          create: true
      defaultRules:
        create: true
      windowsMonitoring:
        enabled: false
      prometheus-windows-exporter:
        prometheus:
          monitor:
            enabled: false
      alertmanager:
        enabled: false
      grafana:
        enabled: false
        forceDeployDashboards: true
        defaultDashboardsEnabled: true
      kubernetesServiceMonitors:
        enabled: true
      kubeApiServer:
        enabled: true
      kubelet:
        enabled: true
      kubeControllerManager:
        enabled: true
      coreDns:
        enabled: true
      kubeDns:
        enabled: false
      kubeEtcd:
        enabled: true
      kubeScheduler:
        enabled: true
      kubeProxy:
        enabled: false
      kubeStateMetrics:
        enabled: true
      nodeExporter:
        enabled: true
      prometheus:
        enabled: true
      thanosRuler:
        enabled: false